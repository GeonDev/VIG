<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ImageMapper"> 	
 	
	<resultMap id="ImageSelectMap" type="image">
		<result property="imageId" 			column="image_id" 			jdbcType="NUMERIC"/>
		<result property="feedId"			column="feed_id" 			jdbcType="NUMERIC" />
		<result property="feedOrder" 		column="feed_order" 		jdbcType="NUMERIC" />
		<result property="isThumbnail" 		column="is_thumbnail" 		jdbcType="NUMERIC" />
		<result property="imageFile" 		column="image_file" 		jdbcType="VARCHAR" />	
		
		<collection property="color" column="image_id" javaType="list" ofType="color" select="getColors"/>
		<collection property="keyword" column="image_id" javaType="list" ofType="keyword" select="getKeywords"/>		
					
	</resultMap>		
	
	 <select id ="getKeywords" parameterType="int" resultMap="KeywordMapper.keywordSelectMap">
		SELECT * FROM keywords
		WHERE keywords.image_id = #{value}		
	 </select>
	 	
	 <select id ="getColors" parameterType="int" resultMap="ColorMapper.ColorSelectMap">
		SELECT * FROM colors 
		WHERE colors.image_id = #{value}		
	 </select>
	 
	  <select id ="getLastImageId" resultType="int">
		SELECT MAX(image_id) FROM images
	 </select>
	 
	 
	 <insert id="addImage" parameterType="image">
	 	INSERT INTO images (imageId, feedId, feedOrder ,isThumbnail, imageFile)
	 	VALUES(image_id, #{feedId}, #{feedOrder:NUMERIC}, #{isThumbnail:NUMERIC}, #{imageFile})	 
	 </insert>
	
	
	
	
	 
</mapper>


