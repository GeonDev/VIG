<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="FollowMapper"> 	

	<resultMap type="follow" id="FollowSelectMap">
		<result property="followId" 	column="follower_id" 	jdbcType="NUMERIC"/>	
		<result property="addDate"  	column="add_date" 	 	jdbcType="DATE" />
		
		<!-- isF4F 맞팔로우 상태인지 확인한다. -->
		<result property="isF4F" 	column="isF4F" 		jdbcType="VARCHAR"/>	
			
		<association property="followUser" 	column="follower_code" 	javaType="user"	  select="setFollow"/>	
		<association property="setUser" 	column="user_code" 	javaType="user"	  select="setFollow"/>		
		
	</resultMap>
 	
 	<select id="setFollow" parameterType="String" resultMap="UserMapper.userSelectMap"> 	
 		SELECT * FROM users
 		WHERE user_code = #{value}
 	
 	</select>
	
	<insert id="addFollow" parameterType="follow">
		INSERT INTO follow(user_code, follower_code, add_date)
		VALUES (#{userCode:VARCHAR}, #{followUser.userCode:VARCHAR}, NOW())

	</insert>

	<delete id="deleteFollow" parameterType="follow">
		DELETE FROM follow
      	WHERE user_code=#{userCode} and follower_code=#{followUser.userCode}
	</delete>
	
	<select id="getFollow" parameterType="follow" resultType="int">
	
		SELECT COUNT(*) FROM follow
		WHERE user_code=#{userCode} and follower_code=#{followUser.userCode}
	
	</select>
	
	<select id="getFollowAll" parameterType="String" resultMap="FollowSelectMap">
			
			SELECT * FROM follow
			WHERE user_code=#{value}
	
	</select>
	
	<!-- 내가 팔로우 한 사람 -->
	<select id="getFollowingList" parameterType="string" resultMap="FollowSelectMap">
		SELECT F.*, (R.follower_code) AS isF4F 
		FROM follow AS F, follow AS R
		WHERE F.follower_code = R.user_code		
		AND F.user_code=#{value}				
	</select>
	
	<!-- 나를 팔로우 한 사람 -->
	<select id="getFollowerList" parameterType="string" resultMap="FollowSelectMap">		
		SELECT F.follower_id, F.user_code, F.follower_code, F.add_date, (R.user_code) AS isF4F 
		FROM follow AS F, follow AS R
		WHERE F.follower_code = R.user_code		
		AND F.follower_code=#{value}
		GROUP BY F.follower_id				
	</select>


	 
</mapper>


